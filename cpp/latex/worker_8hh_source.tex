\hypertarget{worker_8hh_source}{}\doxysection{worker.\+hh}
\label{worker_8hh_source}\index{src/core/worker.hh@{src/core/worker.hh}}
\mbox{\hyperlink{worker_8hh}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <deque>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <folly/executors/thread\_factory/ThreadFactory.h>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{model_8hh}{src/core/model.hh}}"{}}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{scheduler_8hh}{src/core/scheduler.hh}}"{}}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{status_8hh}{src/core/status.hh}}"{}}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetorchserve}{torchserve}} \{}
\DoxyCodeLine{13 \textcolor{comment}{// A model instance represents a model copy on CPU or GPU.}}
\DoxyCodeLine{14 \textcolor{keyword}{class }\mbox{\hyperlink{classtorchserve_1_1_model_instance}{ModelInstance}} \{}
\DoxyCodeLine{15   \textcolor{keyword}{public}:}
\DoxyCodeLine{16   uint16\_t \mbox{\hyperlink{classtorchserve_1_1_model_instance_abc37cde173e887ee2ccc7ad473135f84}{intanceId}};}
\DoxyCodeLine{17 }
\DoxyCodeLine{18   \textcolor{comment}{// Load model on CPU if gpuId = -\/1.}}
\DoxyCodeLine{19   \textcolor{keyword}{virtual} \mbox{\hyperlink{classtorchserve_1_1_status}{Status}} \mbox{\hyperlink{classtorchserve_1_1_model_instance_af70ed8f4ea207a0fe9dcf0864f16663b}{createInstance}}(\textcolor{keyword}{const} \mbox{\hyperlink{classtorchserve_1_1_model}{Model}} \&model, \textcolor{keywordtype}{int} gpuId) = 0;}
\DoxyCodeLine{20 }
\DoxyCodeLine{21   \textcolor{comment}{// Predict the input request.}}
\DoxyCodeLine{22   \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_model_instance_a557c2b288935eca4a61f6beda1b15c99}{predict}}(std::shared\_ptr<BatchJob> \&job) = 0;}
\DoxyCodeLine{23 }
\DoxyCodeLine{24   \textcolor{comment}{// Warmup the model.}}
\DoxyCodeLine{25   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_model_instance_a832f727671df73f62749bdfd9bb411a5}{Warmup}}() = 0;}
\DoxyCodeLine{26 }
\DoxyCodeLine{27   uint16\_t \mbox{\hyperlink{classtorchserve_1_1_model_instance_a8b06ec32e491d348be29e9dd72f67bd3}{GetInstanceId}}();}
\DoxyCodeLine{28 \};}
\DoxyCodeLine{29 }
\DoxyCodeLine{30 \textcolor{comment}{// A ModelInstanceIMP object represents a model copy residenting in main process.}}
\DoxyCodeLine{31 \textcolor{keyword}{class }\mbox{\hyperlink{classtorchserve_1_1_model_instance_i_m_p}{ModelInstanceIMP}} : \textcolor{keyword}{public} \mbox{\hyperlink{classtorchserve_1_1_model_instance}{ModelInstance}} \{}
\DoxyCodeLine{32   \textcolor{keyword}{public}:}
\DoxyCodeLine{33   \mbox{\hyperlink{classtorchserve_1_1_model_instance_i_m_p_af01626a70d21ee095b2a569e9e46e8dc}{ModelInstanceIMP}}(uint16\_t instanceId);}
\DoxyCodeLine{34 }
\DoxyCodeLine{35   \mbox{\hyperlink{classtorchserve_1_1_status}{Status}} \mbox{\hyperlink{classtorchserve_1_1_model_instance_i_m_p_a8b276e62c7dabaa68df6f36bbb746b6e}{createInstance}}(\textcolor{keyword}{const} \mbox{\hyperlink{classtorchserve_1_1_model}{Model}} \&model, \textcolor{keywordtype}{int} gpuId);}
\DoxyCodeLine{36 }
\DoxyCodeLine{37   \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_model_instance_i_m_p_a66c1b052cbe9e5376681cf0331610b5b}{predict}}(std::shared\_ptr<BatchJob> \&job);}
\DoxyCodeLine{38 }
\DoxyCodeLine{39   \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_model_instance_i_m_p_a3fb71dba81d62820a40fd0cf2a1825aa}{warmup}}();}
\DoxyCodeLine{40 }
\DoxyCodeLine{41   \textcolor{keyword}{private}:}
\DoxyCodeLine{42   std::shared\_ptr<BackendModel> \mbox{\hyperlink{classtorchserve_1_1_model_instance_i_m_p_a0895e6cbcd162e71251107c9bbaa9d2a}{backendModel}};}
\DoxyCodeLine{43 \};}
\DoxyCodeLine{44 }
\DoxyCodeLine{45 \textcolor{comment}{// A ModelInstanceOMP object represents an agent of a model copy residenting in out-\/of-\/main-\/process.}}
\DoxyCodeLine{46 \textcolor{keyword}{class }\mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p}{ModelInstanceOMP}} : \textcolor{keyword}{public} \mbox{\hyperlink{classtorchserve_1_1_model_instance}{ModelInstance}} \{}
\DoxyCodeLine{47   \textcolor{keyword}{public}:}
\DoxyCodeLine{48   \mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p_aa5c8a9a17b1255422f6a21b70a02eed0}{ModelInstanceOMP}}(uint16\_t instanceId, uint32\_t \mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p_a2c72fd47ad6e67f3f9289e57b94e112c}{port}});}
\DoxyCodeLine{49 }
\DoxyCodeLine{50   \textcolor{comment}{// Create remote server and load model}}
\DoxyCodeLine{51   \mbox{\hyperlink{classtorchserve_1_1_status}{Status}} \mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p_a9a017f937be1db34105f4ac09e698d85}{createInstance}}(\textcolor{keyword}{const} \mbox{\hyperlink{classtorchserve_1_1_model}{Model}} \&model, \textcolor{keywordtype}{int} gpuId);}
\DoxyCodeLine{52 }
\DoxyCodeLine{53   \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p_a05eda727f405075dd14d2e4da490f52d}{predict}}(std::shared\_ptr<BatchJob> \&job);}
\DoxyCodeLine{54 }
\DoxyCodeLine{55   \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p_a6e30c59f9ad94b34617f4bc989fb5e1c}{warmup}}();}
\DoxyCodeLine{56 }
\DoxyCodeLine{57   uint32\_t \mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p_a1d30a9e76d0dda3c73cc7b58a1ad1c09}{getRemotePort}}();}
\DoxyCodeLine{58   }
\DoxyCodeLine{59   \textcolor{keyword}{private}:}
\DoxyCodeLine{60   uint32\_t \mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p_a2c72fd47ad6e67f3f9289e57b94e112c}{port}};}
\DoxyCodeLine{61   \mbox{\hyperlink{classtorchserve_1_1_status}{Status}} \mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p_abc0027bf46264d2ea05ae646de2053dd}{connectBackend}}(uint32\_t \mbox{\hyperlink{classtorchserve_1_1_model_instance_o_m_p_a2c72fd47ad6e67f3f9289e57b94e112c}{port}});}
\DoxyCodeLine{62 \};}
\DoxyCodeLine{63 }
\DoxyCodeLine{64 \textcolor{keyword}{class }\mbox{\hyperlink{classtorchserve_1_1_worker}{Worker}} \{}
\DoxyCodeLine{65   \textcolor{keyword}{public}:}
\DoxyCodeLine{66   uint16\_t \mbox{\hyperlink{classtorchserve_1_1_worker_a9eacf104ee12c0d75e7fd75eae12daff}{workerId}};}
\DoxyCodeLine{67   }
\DoxyCodeLine{68   \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_worker_aa0f90e9dafeb082d0b46e898ce929133}{run}}(\mbox{\hyperlink{classtorchserve_1_1_job}{Job}} \&job) = 0;}
\DoxyCodeLine{69 \};}
\DoxyCodeLine{70 }
\DoxyCodeLine{71 \textcolor{comment}{// A WorkerIMP object is associated with a ModelInstanceIMP object.}}
\DoxyCodeLine{72 \textcolor{keyword}{class }\mbox{\hyperlink{classtorchserve_1_1_worker_i_m_p}{WorkerIMP}} : \textcolor{keyword}{public} \mbox{\hyperlink{classtorchserve_1_1_worker}{Worker}} \{}
\DoxyCodeLine{73   \textcolor{keyword}{public}:}
\DoxyCodeLine{74   std::shared\_ptr<ModelInstanceIMP> \mbox{\hyperlink{classtorchserve_1_1_worker_i_m_p_ae7e2f7fcabc8a179bd1b6893176b7d83}{modelInstance}};}
\DoxyCodeLine{75 }
\DoxyCodeLine{76   \mbox{\hyperlink{classtorchserve_1_1_worker_i_m_p_aaacf64d01385cdfaee4dbe89445a1974}{WorkerIMP}}(std::shared\_ptr<ModelInstanceIMP> \&\mbox{\hyperlink{classtorchserve_1_1_worker_i_m_p_ae7e2f7fcabc8a179bd1b6893176b7d83}{modelInstance}});}
\DoxyCodeLine{77   \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_worker_i_m_p_a527246a658b739567da649eb90e4649a}{run}}(\mbox{\hyperlink{classtorchserve_1_1_job}{Job}} \&job);}
\DoxyCodeLine{78 \};}
\DoxyCodeLine{79 }
\DoxyCodeLine{80 \textcolor{comment}{// A WorkerOMP is an agent of a backend worker associated with a ModelInstanceOMP.}}
\DoxyCodeLine{81 \textcolor{keyword}{class }\mbox{\hyperlink{classtorchserve_1_1_worker_o_m_p}{WorkerOMP}} : \textcolor{keyword}{public} \mbox{\hyperlink{classtorchserve_1_1_worker}{Worker}} \{}
\DoxyCodeLine{82   \textcolor{keyword}{public}:}
\DoxyCodeLine{83   std::shared\_ptr<ModelInstanceOMP> \mbox{\hyperlink{classtorchserve_1_1_worker_o_m_p_a67ead4336fe3cc624f985461bae47fc5}{modelInstance}};}
\DoxyCodeLine{84 }
\DoxyCodeLine{85   \mbox{\hyperlink{classtorchserve_1_1_worker_o_m_p_a68b788cdf3f3e7e0df95c7d77903eeeb}{WorkerOMP}}(std::shared\_ptr<ModelInstanceOMP> \&\mbox{\hyperlink{classtorchserve_1_1_worker_o_m_p_a67ead4336fe3cc624f985461bae47fc5}{modelInstance}});}
\DoxyCodeLine{86   \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_worker_o_m_p_aa3959d93bff244ab4c1413566574798c}{run}}(\mbox{\hyperlink{classtorchserve_1_1_job}{Job}} \&job);}
\DoxyCodeLine{87 }
\DoxyCodeLine{88   \textcolor{keyword}{private}:}
\DoxyCodeLine{89   uint32\_t \mbox{\hyperlink{classtorchserve_1_1_worker_o_m_p_a8bba6a0c5e603ded1fd59846b09461f2}{port}};}
\DoxyCodeLine{90   \mbox{\hyperlink{classtorchserve_1_1_status}{Status}} \mbox{\hyperlink{classtorchserve_1_1_worker_o_m_p_a37fbfb5e1584eff53c662d4abbebf7a2}{connectBackend}}(uint32\_t \mbox{\hyperlink{classtorchserve_1_1_worker_o_m_p_a8bba6a0c5e603ded1fd59846b09461f2}{port}});}
\DoxyCodeLine{91 \};}
\DoxyCodeLine{92 \}  \textcolor{comment}{// namespace torchserve}}

\end{DoxyCode}
