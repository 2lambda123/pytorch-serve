\hypertarget{worker_manager_8hh_source}{}\doxysection{worker\+Manager.\+hh}
\label{worker_manager_8hh_source}\index{src/core/workerManager.hh@{src/core/workerManager.hh}}
\mbox{\hyperlink{worker_manager_8hh}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <deque>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <folly/executors/CPUThreadPoolExecutor.h>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include "{}blockingconcurrentqueue.h"{}}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{model_8hh}{src/core/model.hh}}"{}}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{scheduler_8hh}{src/core/scheduler.hh}}"{}}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{status_8hh}{src/core/status.hh}}"{}}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{worker_8hh}{src/core/worker.hh}}"{}}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{backend_8hh}{src/backend/backend.hh}}"{}}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetorchserve}{torchserve}} \{}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{keyword}{template} <\textcolor{keyword}{class} T1>}
\DoxyCodeLine{17 \textcolor{keyword}{class }\mbox{\hyperlink{classtorchserve_1_1_worker_manager}{WorkerManager}} : \textcolor{keyword}{public} \mbox{\hyperlink{classtorchserve_1_1_scheduler}{Scheduler}}<T1> \{}
\DoxyCodeLine{18   \textcolor{keyword}{public}:}
\DoxyCodeLine{19   \textcolor{keyword}{static} std::unordered\_map<BackendType, std::shared\_ptr<Backend>> \mbox{\hyperlink{classtorchserve_1_1_worker_manager_a1d39835df33475b30f95140bac163438}{backendMap}};}
\DoxyCodeLine{20 }
\DoxyCodeLine{21   \mbox{\hyperlink{classtorchserve_1_1_worker_manager_a4c15fdf265f85923903f3771ef4d25b7}{\string~WorkerManager}}();}
\DoxyCodeLine{22 }
\DoxyCodeLine{23   \textcolor{comment}{// Load backend if it is needed.}}
\DoxyCodeLine{24   \mbox{\hyperlink{classtorchserve_1_1_status}{Status}} \mbox{\hyperlink{classtorchserve_1_1_worker_manager_ada718e5bfdf08fbec217ca523b738bed}{registerBackend}}(\textcolor{keyword}{const} \mbox{\hyperlink{classtorchserve_1_1_model}{Model}} \&model);}
\DoxyCodeLine{25 }
\DoxyCodeLine{26   \textcolor{comment}{// Create model instances concurrently; store them into modelInstances.  }}
\DoxyCodeLine{27   \textcolor{comment}{// A model instance residents in either in main process or out-\/of-\/main-\/process.}}
\DoxyCodeLine{28   \textcolor{comment}{// A model instance is a wrapper of a model copy on CPU or GPU.}}
\DoxyCodeLine{29   \mbox{\hyperlink{classtorchserve_1_1_status}{Status}} \mbox{\hyperlink{classtorchserve_1_1_worker_manager_a50de02de3dbd3544b782d00a704ecd3f}{createModelInstances}}(\textcolor{keyword}{const} \mbox{\hyperlink{classtorchserve_1_1_model}{Model}} \&model);}
\DoxyCodeLine{30 }
\DoxyCodeLine{31   \textcolor{comment}{// Create workerThreadPool. Each worker thread associates with one modelInstance.}}
\DoxyCodeLine{32   \mbox{\hyperlink{classtorchserve_1_1_status}{Status}} \mbox{\hyperlink{classtorchserve_1_1_worker_manager_a537b156ab090470402c8d4acf597606b}{addWorkers}}(\textcolor{keywordtype}{int} numWorkers);}
\DoxyCodeLine{33 }
\DoxyCodeLine{34   \textcolor{comment}{// Add a job into jobQueue.}}
\DoxyCodeLine{35   \textcolor{keywordtype}{void} \mbox{\hyperlink{classtorchserve_1_1_worker_manager_a8e032ecdc7bb4b8a87385663c9e703de}{enqueue}}(\textcolor{keyword}{const} std::unique\_ptr<T1> \&job);}
\DoxyCodeLine{36   }
\DoxyCodeLine{37   \textcolor{keyword}{private}:}
\DoxyCodeLine{38   std::shared\_ptr<Backend> \mbox{\hyperlink{classtorchserve_1_1_worker_manager_abab8d301b90704b363b381c19e84a993}{backend}};}
\DoxyCodeLine{39   moodycamel::BlockingConcurrentQueue<BatchJob> \mbox{\hyperlink{classtorchserve_1_1_worker_manager_a5b28e32055a0a9c9c1cbd0b1568ceeb7}{batchJobQueue}};}
\DoxyCodeLine{40   std::vector<std::shared\_ptr<ModelInstance> > \mbox{\hyperlink{classtorchserve_1_1_worker_manager_a9dc7433eab15a27cef954dda7dfb15d3}{modelInstances}};}
\DoxyCodeLine{41   std::unique\_ptr<folly::CPUThreadPoolExecutor>> \mbox{\hyperlink{classtorchserve_1_1_worker_manager_acb3139f0f596dad2658c1eaf7b561dfd}{workerThreadPool}};}
\DoxyCodeLine{42 \};}
\DoxyCodeLine{43 \}  \textcolor{comment}{// namespace torchserve}}

\end{DoxyCode}
